# eclectyc.energy/httpdocs/.htaccess
# --------------------------------------------------------------------
# Eclectyc Energy - Root-Level .htaccess
#
# This file:
# - Redirects all web traffic from the parent directory into /public/
#   when the DocumentRoot is set to the parent (httpdocs).
# - Avoids redirect loops for /public and /public/.
# - Disables directory browsing.
# - Blocks access to hidden and sensitive files.
# --------------------------------------------------------------------

# Disable directory browsing
Options -Indexes

<IfModule mod_rewrite.c>
    RewriteEngine On

    # ------------------------------------------------------------
    # 1. Avoid redirect loops for /public and /public/
    # ------------------------------------------------------------
    # If the request is exactly /public or /public/, do not apply
    # the generic redirect rule below.
    RewriteCond %{REQUEST_URI} ^/public/?$ [NC]
    RewriteRule ^ - [L]

    # ------------------------------------------------------------
    # 2. Redirect everything else into /public/
    # ------------------------------------------------------------
    # Only redirect if:
    # - The request is NOT already under /public/,
    # - And the target is not an existing file or directory.
    RewriteCond %{REQUEST_URI} !^/public/ [NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ /public/$1 [L,QSA]

</IfModule>

# ------------------------------------------------------------
# 3. Protect hidden files (.env, .git, etc.)
# ------------------------------------------------------------
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# ------------------------------------------------------------
# 4. Protect configuration and other sensitive files
# ------------------------------------------------------------
<FilesMatch "\.(env|json|lock|md|sql|sh)$">
    Require all denied
</FilesMatch>
